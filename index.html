<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Valentine</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500&display=swap" rel="stylesheet">

<style>
html,body{margin:0;height:100%;overflow:hidden;font-family:Poppins,sans-serif}
#gradientBg{position:fixed;inset:0;background:linear-gradient(-45deg,#fde2ea,#fff1f5,#fce7f3);background-size:400% 400%;animation:g 14s ease infinite;z-index:0}
@keyframes g{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

#photoBg{position:fixed;inset:0;background-size:contain;background-repeat:no-repeat;background-position:center;opacity:.6;display:none;z-index:1}
#photoOverlay{position:fixed;inset:0;background:rgba(255,240,246,.45);display:none;z-index:2}

.heart{position:absolute;top:-40px;font-size:26px;opacity:.35;animation:fall linear infinite;z-index:5}
@keyframes fall{to{transform:translateY(120vh)}}

#sender,#receiver,#musicGate{position:absolute;inset:0;z-index:10}
#sender,#receiver{display:none;align-items:center;justify-content:center}
#sender{display:flex}

.form{background:rgba(255,255,255,.92);border-radius:28px;padding:30px;width:360px;box-shadow:0 40px 80px rgba(255,105,135,.3)}
h1{text-align:center;font-family:Playfair Display;color:#c9184a}

input,select,textarea,button{width:100%;margin-top:12px;padding:12px;border-radius:14px;border:1px solid #ddd;font-family:Poppins}

button{background:linear-gradient(135deg,#c9184a,#e6396f);color:#fff;border:none;cursor:pointer}

#receiverContent{text-align:center;max-width:720px}
.title{font-size:22px;letter-spacing:2px;color:#d6336c;opacity:0}
.valentine{font-family:Great Vibes;font-size:64px;color:#c9184a;opacity:0}
.name{font-family:Playfair Display;font-size:52px;color:#9d0208;opacity:0}
.message div{margin:6px 0;color:#7b2d3a}
.signature{margin-top:24px;font-size:14px;color:#b56576;opacity:0}
.fade{animation:f 1.2s forwards}
@keyframes f{to{opacity:1}}

#musicGate{background:rgba(255,255,255,.88);display:none;align-items:center;justify-content:center;flex-direction:column}
#revealHeart{font-size:46px;display:none;cursor:pointer}
#shareBox{display:none;margin-top:12px}
</style>
</head>

<body>

<div id="gradientBg"></div>
<div id="photoBg"></div>
<div id="photoOverlay"></div>

<!-- SENDER -->
<div id="sender">
  <div class="form">
    <h1>Make your Valentine feel Special</h1>

    <input id="nameInput" placeholder="Their name">

    <select id="messageSelect">
      <option value="">Choose a message</option>
      <option value="Every day feels a little lighter|||Knowing you‚Äôre a part of my life.|||I‚Äôm grateful for you, always.">
        Grateful Always ‚Äî Every day feels a little lighter knowing you‚Äôre a part of my life.
      </option>
      <option value="Some people don‚Äôt just enter our lives,|||They slowly become a part of our happiness.|||You‚Äôre one of them.">
        A Part of My Happiness ‚Äî Some people don‚Äôt just enter our lives‚Ä¶
      </option>
    </select>

    <input type="file" id="photoInput" accept="image/*">
    <input id="spotifyInput" placeholder="Spotify link">

    <button onclick="openPreview()">Preview</button>

    <div id="shareBox">
      <p>Copy & share this link üíó</p>
      <input id="shareLink" readonly>
    </div>
  </div>
</div>

<!-- RECEIVER -->
<div id="receiver">
  <div id="receiverContent">
    <div class="title" id="t1">Happy</div>
    <div class="valentine" id="t2">Valentine‚Äôs Day</div>
    <div class="name" id="t3"></div>
    <div class="message" id="t4"></div>
    <div class="signature" id="t5">From someone smiling while you read this.</div>
  </div>
</div>

<!-- MUSIC -->
<div id="musicGate">
  <iframe id="spotifyPlayer" width="360" height="152"></iframe>
  <button onclick="showHeart()">Tap after music ‚ù§Ô∏è</button>
  <div id="revealHeart" onclick="reveal()">üíó</div>
</div>

<script>
const CLOUD="dc0sk6pqu";
const PRESET="valentine_surprise";

async function uploadImage(file){
  const f=new FormData();
  f.append("file",file);
  f.append("upload_preset",PRESET);
  const r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD}/image/upload`,{method:"POST",body:f});
  const d=await r.json();
  return d.secure_url;
}

async function openPreview(){
  let img="";
  if(photoInput.files.length) img=await uploadImage(photoInput.files[0]);

  const params=new URLSearchParams({
    name:nameInput.value,
    message:messageSelect.value,
    spotify:spotifyInput.value,
    image:img
  });

  shareLink.value=location.origin+location.pathname+"?"+params.toString();
  shareBox.style.display="block";

  sender.style.display="none";
  receiver.style.display="flex";
  t3.textContent=nameInput.value;
  t4.innerHTML="";
  messageSelect.value.split("|||").forEach(l=>{
    const d=document.createElement("div");d.textContent=l;t4.appendChild(d);
  });

  if(img){
    photoBg.style.backgroundImage=`url(${img})`;
    photoBg.style.display="block";
    photoOverlay.style.display="block";
  }

  spotifyPlayer.src=spotifyInput.value.replace("open.spotify.com","open.spotify.com/embed");
  musicGate.style.display="flex";
}

function showHeart(){revealHeart.style.display="block"}
function reveal(){
  musicGate.style.display="none";
  [t1,t2,t3,t4,t5].forEach((e,i)=>setTimeout(()=>e.classList.add("fade"),i*900));
}

(function(){
  const p=new URLSearchParams(location.search);
  if(!p.has("name"))return;
  sender.style.display="none";
  receiver.style.display="flex";
  t3.textContent=p.get("name");
  p.get("message").split("|||").forEach(l=>{
    const d=document.createElement("div");d.textContent=l;t4.appendChild(d);
  });
  if(p.get("image")){
    photoBg.style.backgroundImage=`url(${p.get("image")})`;
    photoBg.style.display="block";
    photoOverlay.style.display="block";
  }
  spotifyPlayer.src=p.get("spotify")?.replace("open.spotify.com","open.spotify.com/embed")||"";
  musicGate.style.display="flex";
})();
</script>

</body>
</html>
